var passportModel=new Vue({el:".passport-common",name:"passportCommon",data:{sms:"发送",sended:!1,error:!1,errorMsg:"",delay:5e3,verify:!1,isImageVerify:!1},methods:{verifyTel:function(e){var r=/^1(3|4|5|7|8)\d{9}$/;return r.test(e)},verifyEmail:function(e){var r=/^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/;return r.test(e)},verifyImage:function(e){var r=/^[a-zA-Z0-9]{4}$/;return r.test(e)},verifySMS:function(e){var r=/^\d{6}$/;return r.test(e)},passwordLength:function(e){var r=/^.{6,20}$/;return r.test(e)},cancelNotice:function(){var e=this;setTimeout(function(){e.error=!1},e.delay)},errorFn:function(e){this.errorMsg=e,this.error=!0,this.cancelNotice()},getVerify:function(e){var r=e.$refs.verifyImage;r.src="/Passport/VerifyImage?r="+Math.random()},getImageVerify:function(e,r){var s=this;$.ajax({url:"/passport/IsRightValidateCode",type:"POST",async:!1,data:{code:e.$refs.imageVerify.value},success:function(t){return t?(r||s.sended||($(e.$refs.imageVerify).addClass("success"),s.getSMSVerify(e.$refs.telPhoneNum.value)),s.isImageVerify=!0,!0):(s.errorFn("图形验证码不正确"),e.$refs.imageVerify.focus(),e.$refs.imageVerify.select(),$(e.$refs.imageVerify).removeClass("success error").addClass("error"),s.isImageVerify=!1,!1)}})},countdown:function(){var e=20,r=null,s=this;this.sms='重新发送(<em style="color:red;font-style:normal;">'+e+"</em>)s",this.sended=!0,r=setInterval(function(){return e--,e<=0?(clearInterval(r),s.sended=!1,void(s.sms="重新发送")):void(s.sms='重新发送(<em style="color:red;font-style:normal;">'+e+"</em>)s")},1e3)},getSMSVerify:function(e){var r=headerModel.api+"/Passport/SendPhoneCode?phone="+e+"&t=getpwd";this.$http.get(r).then(function(e){200==e.data.resultid?(this.countdown(),$.dialog({type:"ok",message:"发送成功！",delay:2e3,effect:!0})):this.errorFn(e.message)})},sendSMS:function(e){var r=e.$refs.telPhoneNum,s=e.$refs.imageVerify;return""!==r.value&&this.verifyTel(r.value)?($(r).addClass("success"),""!==s.value||this.verifyImage(s.value)?void this.getImageVerify(e):(this.errorFn("请填写正确的图形验证码"),s.focus(),s.select(),void $(s).removeClass("success error").addClass("error"))):(this.errorFn("请填写正确的手机号码"),r.focus(),r.select(),void $(r).removeClass("success error").addClass("error"))}}});