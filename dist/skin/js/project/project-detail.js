var projectDetail=new Vue({el:"#detail",data:{TimesRotation:["种子期","天使期","pre-A轮","A轮","B轮","C轮"],tabShow:0,detailNavCur:0,detailNav:!1,shareShow:!0,isFirstTab:!0,loading:!1,wechatShare:!1,webShare:!1,detail:"",followPersonList:[],projectQAList:{},proId:""},methods:{toggleTab:function(e){this.tabShow=e,1===e?this.getProjectQAList():2===e&&this.getFollowPerson()},getProjectDetail:function(){$("#loader").fadeIn("300");var e=headerModel.api+"/ZhongChou/Detail/"+this.proId+"?token=1";this.$http.get(e).then(function(e){e.data&&(this.detail=e.data,this.$nextTick(function(){this.share(),this.getPicWidth(),this.resize()}),$("#loader").fadeOut("300"))})},getFollowPerson:function(){this.followPersonList=this.detail.FollowPerson},getProjectQAList:function(){if(!this.isFirstTab)return!1;headerModel.loading=!0;var e=headerModel.api+"/ZhongChou/ProjectQAList?projectid="+this.proId;this.$http.get(e).then(function(e){this.projectQAList=e.data.list.reverse(),headerModel.loading=!1,this.isFirstTab=!1})},AddProjectQA:function(){var e=this,t=e.$refs.qaText;if(!headerModel.isLogin)return $.dialog({type:"warning",message:"请先登录！",buttons:[{text:"登录",type:"green",callback:function(){window.location="/passport/login.html?url="+window.location.href}},{text:"取消",type:"red"}],maskClose:!0,effect:!0}),!1;if(""===t.value)return $.dialog({type:"warning",message:"请填写留言内容",delay:2e3,maskClose:!0,effect:!0}),this.$refs.qaText.focus(),!1;headerModel.loading=!0;var o=headerModel.api+"/ZhongChou/AddProjectQA";$.ajax({url:o,method:"POST",data:{ProjectID:e.proId,Content:t.value,Token:headerModel.token,ParentID:0}}).done(function(o){console.log(o),t.value="",e.isFirstTab=!0,e.getProjectQAList(),headerModel.loading=!1})},scroll:function(){this.navigatorFn(),this.navigatorPos(),this.sidebarPos()},navigatorFn:function(){$(window).scroll(function(){var e=$(".item-desc").find(".content-item"),t=$(".detail-nav"),o=$(document).scrollTop(),i="",n=t.find(".current");e.each(function(){var e=$(this);o>e.offset().top-200&&(i="#"+e.attr("id"))}),i&&n.attr("href")!==i&&(n.removeClass("current"),t.find("[href="+i+"]").addClass("current"))})},navigatorPos:function(){var e=this;$(window).scroll(function(){var t=(e.$refs.detailNav,e.$refs.container),o=$(document).scrollTop();o>t.offsetTop-400?e.detailNav=!0:e.detailNav=!1})},sidebarPos:function(){var e=this;$(window).scroll(function(){var t=e.$refs.sidebar,o=e.$refs.container,i=$(document).scrollTop(),n=headerModel.$refs.header.offsetHeight,a=document.body.clientWidth||document.documentElement.clientWidth;a>=900&&(o.style.minHeight=t.offsetHeight+"px",o.offsetTop-n<=i?$(t).css({position:"fixed",width:$(t).parent().width(),top:n}):$(t).css({position:"relative",top:0}))})},getPicWidth:function(){var e=$(".item-desc img");e.each(function(){$(this).width()>$(document).width()&&$(this).parent("p").css("overflow-x","auto")})},share:function(){DGDTOOLS.Ev._share(".iShare1")},weChatShare:function(){if(DGDTOOLS.check._isWeixin())this.wechatShare=!0;else{this.webShare=!0;var e=DGDTOOLS.Ev._loadJS("/skin/js/project/qrcode.min.js");if(null==e)return void setTimeout(function(){DGDTOOLS.Ev._createQrcode(document.querySelector("#canvas"))},40);e.onload=function(){DGDTOOLS.Ev._createQrcode(document.querySelector("#canvas"))}}},resize:function(){var e=this;window.onresize=function(){var t=e.$refs.sidebar,o=headerModel.$refs.header.offsetHeight,i=document.body.clientWidth||document.documentElement.clientWidth;i>=900?e.scroll():(t.style.width="100%",t.style.position="static"),t.style.width=t.parentNode.offsetWidth+"px","fixed"==t.style.position&&(t.style.top=o+"px")}}},computed:{totalFollowPerson:function(){if(this.detail)return this.detail.FollowPerson.length}},mounted:function(){var e=this;return this.proId=window.location.search.split("id=")[1]||0,0==this.proId?(window.location.href="./index.html",!1):void e.getProjectDetail()}});