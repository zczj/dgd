var msgModel=new Vue({el:"#msg-center",data:{pageSize:1,curPage:1,Pagedata:"",list:""},computed:{comList:function(){for(var e=[],t=[],o=this.list?this.list:[],a=0;a<o.length;a++)0==o[a].ParentID?(o[a].comSon=[],e.push(o[a])):t.push(o[a]);for(var s=0;s<e.length;s++)for(var a=0;a<t.length;a++)t[a].ParentID==e[s].ID&&e[s].comSon.push(t[a]);return e},PagesIndex:function(){return DGDTOOLS.Ev._setPage(this.totalPage,this.curPage)},totalPage:function(){return this.Pagedata.pagecount}},methods:{getMsgList:function(e,t,o,a){var s=this;e?headerModel.loading=!0:$("#loader").fadeIn(300),$.ajax({url:headerModel.api+"/MyCenter/GetMessageList",data:{Token:headerModel.token,MonthNum:0,currentpage:s.curPage,pagesize:s.pageSize},type:"post",success:function(n){e?headerModel.loading=!1:$("#loader").fadeOut(300),200===n.resultid?(s.Pagedata=n,t?o?s.list.pop({Account:mySideModel.userBaseInfo.UserName,Avatar:mySideModel.userBaseInfo.Avatar,UserID:mySideModel.userBaseInfo.uid,PostDate:"刚刚",Content:s.comTxt,ParentID:a}):s.list=s.list.concat(n.RelpyList):s.list=n.RelpyList):DGDTOOLS.tip._tip(n.message)},error:function(t){e?headerModel.loading=!1:$("#loader").fadeOut(300),DGDTOOLS.tip._tip(t.status+":接口异常"),console.error(t.status+":"+t.responseText)}})},toggleRepay:function(e,t){var o=this,a=$(t.target).parents(".com-cont"),s='<div class="com-form"><div class="com-inner"><textarea placeholder="来说两句吧……" value="" class="com-box"></textarea></div> <div class="com-ft clearfix"><!----> <button data-color="#fff">发表评论</button></div></div>';return a.find(".com-form").length?void a.find(".com-form").toggle():(a.append(s),void a.find("button").click(function(){o.comTxt=a.find("textarea").val(),o.postComment(e,a.find("textarea"))}))},checkComment:function(e){return headerModel.isLogin?""!=e.val()||(DGDTOOLS.tip._tip("请说两句。。。",function(){e.focus()}),!1):(DGDTOOLS.check._isLogin(),!1)},postComment:function(e,t){var o=this,a=e?e:0;t=t?t:$(o.$refs.comTxt),o.comTxt=t.val(),o.checkComment(t)&&(headerModel.loading=!0,$.ajax({url:headerModel.api+"/MyCenter/ReplyMessage",data:{token:headerModel.token,Content:o.comTxt,MessageID:a},type:"post",success:function(e){headerModel.loading=!1,200==e.resultid?(t.val(""),headerModel.isMobileOrTable?o.getMsgList(1,"mb","oppend",a):o.getMsgList()):DGDTOOLS.tip._tip(e.message)},error:function(e){headerModel.loading=!1,DGDTOOLS.tip._tip(e.status+":接口异常"),console.error(e.status+":"+e.responseText)}}))},pageClick:function(e,t){e!=this.curPage&&(this.curPage=e,t?this.getMsgList(1,"mb"):this.getMsgList(1))},delMsg:function(e,t){console.log(e),headerModel.loading=!0,$.ajax({url:headerModel.api+"/MyCenter/DelMessage",data:{Token:headerModel.token,MsgID:e},type:"post",success:function(e){headerModel.loading=!1,200===e.resultid?DGDTOOLS.tip._tipAll({type:"ok"}):DGDTOOLS.tip._tip(e.message)},error:function(e){headerModel.loading=!1,DGDTOOLS.tip._tip(e.status+":接口异常"),console.error(e.status+":"+e.responseText)}})}},mounted:function(){this.getMsgList()}});