var projectDetail=new Vue({el:"#detail",data:{TimesRotation:["种子期","天使期","pre-A轮","A轮","B轮","C轮"],tabShow:0,detailNavCur:0,detailNav:!1,shareShow:!0,isFirstTab:!0,loading:!1,wechatShare:!1,webShare:!1,detail:"",followPersonList:[],projectQAList:{},proId:"",authen:"",qaReplyTexarea:!1,qaReplyTexareaIndex:0},methods:{toggleTab:function(e){this.tabShow=e,1===e?this.getProjectQAList():2===e&&this.getFollowPerson()},getProjectDetail:function(){$("#loader").fadeIn("300");var e=headerModel.api+"/ZhongChou/Detail/"+this.proId+"?token=1";this.$http.get(e).then(function(e){e.data&&(this.detail=e.data,this.$nextTick(function(){this.share(),this.getPicWidth(),this.scroll(),this.resize()}),$("#loader").fadeOut("300"))})},getFollowPerson:function(){this.followPersonList=this.detail.FollowPerson},getProjectQAList:function(){if(!this.isFirstTab)return!1;headerModel.loading=!0;var e=headerModel.api+"/ZhongChou/ProjectQAList?projectid="+this.proId;this.$http.get(e).then(function(e){for(var t=0;t<e.data.list.length;t++)e.data.list[t].ChlidList=e.data.list[t].ChlidList.reverse();this.projectQAList=e.data.list.reverse(),headerModel.loading=!1,this.isFirstTab=!1,this.qaReplyTexarea=!1})},AddProjectQA:function(e){var t,i,o=this,a=o.$refs.qaText,n=e||0;if(!headerModel.isLogin)return DGDTOOLS.check._isLogin(),!1;if(0===n){if(i=a,""===i.value)return $.dialog({type:"warning",message:"请填写留言内容",delay:2e3,maskClose:!0,effect:!0}),i.focus(),!1}else if(0!==n&&(t=o.$refs.qaReplyText,i=t[0],""===i.value))return $.dialog({type:"warning",message:"请填写回复内容",delay:2e3,maskClose:!0,effect:!0}),i.focus(),!1;headerModel.loading=!0;var r=headerModel.api+"/ZhongChou/AddProjectQA";$.ajax({url:r,method:"POST",data:{ProjectID:o.proId,Content:i.value,Token:headerModel.token,ParentID:n}}).done(function(e){a.value="",o.isFirstTab=!0,o.getProjectQAList(),headerModel.loading=!1})},toggleQaReply:function(e){this.qaReplyTexareaIndex===e&&(this.qaReplyTexarea=!this.qaReplyTexarea),this.qaReplyTexareaIndex=e},scroll:function(){var e=this.$refs.sidebar,t=headerModel.$refs.header.offsetHeight,i=document.body.clientWidth||document.documentElement.clientWidth;i>=900?(this.navigatorFn(),this.navigatorPos(),this.sidebarPos()):(e.style.width="100%",e.style.position="static"),e.style.width=e.parentNode.offsetWidth+"px","fixed"==e.style.position&&(e.style.top=t+"px")},navigatorFn:function(){$(window).scroll(function(){var e=$(".item-desc").find(".content-item"),t=$(".detail-nav"),i=$(document).scrollTop(),o="",a=t.find(".current");e.each(function(){var e=$(this);return i>e.offset().top-200&&void(o="#"+e.attr("id"))}),o&&a.attr("href")!==o&&(a.removeClass("current"),t.find("[href="+o+"]").addClass("current"))})},navigatorPos:function(){var e=this;$(window).scroll(function(){var t=(e.$refs.detailNav,e.$refs.container),i=$(document).scrollTop();i>t.offsetTop-400?e.detailNav=!0:e.detailNav=!1})},sidebarPos:function(){var e=this;$(window).scroll(function(){var t=e.$refs.sidebar,i=e.$refs.container,o=$(document).scrollTop(),a=headerModel.$refs.header.offsetHeight,n=document.body.clientWidth||document.documentElement.clientWidth;n>=900&&(i.style.minHeight=t.offsetHeight+"px",i.offsetTop-a<=o?$(t).css({position:"fixed",width:$(t).parent().width(),top:a}):$(t).css({position:"relative",top:0}))})},getPicWidth:function(){var e=$(".item-desc img");e.each(function(){$(this).width()>$(document).width()&&$(this).parent("p").css("overflow-x","auto")})},share:function(){DGDTOOLS.Ev._share(".iShare1")},weChatShare:function(){if(DGDTOOLS.check._isWeixin())this.wechatShare=!0;else{this.webShare=!0;var e=DGDTOOLS.Ev._loadJS("/skin/js/project/qrcode.min.js");if(null==e)return void setTimeout(function(){DGDTOOLS.Ev._createQrcode(document.querySelector("#canvas"))},40);e.onload=function(){DGDTOOLS.Ev._createQrcode(document.querySelector("#canvas"))}}},resize:function(){var e=this;window.onresize=function(){e.scroll()}},getAuthen:function(){$("#loader").fadeIn(300),this.$http.get(headerModel.api+"/Pay/QueryAuthenticator?token="+headerModel.token).then(function(e){$("#loader").fadeOut(300),this.authen=e.data.State})},buyNow:function(e){return headerModel.isLogin?this.authen?void(window.location.href="/Order/Index?id="+e):void DGDTOOLS.tip._tip("请认证投资人！",function(){window.location.href;window.location.href="http://test.dgd.vc/mycenter/authentication?url="+window.location.href}):void DGDTOOLS.check._isLogin()}},computed:{totalFollowPerson:function(){if(this.detail)return this.detail.FollowPerson.length}},mounted:function(){var e=this;return this.proId=window.location.search.split("id=")[1]||0,0==this.proId?(window.location.href="./Index/Index",!1):(e.getProjectDetail(),void e.getAuthen())}});