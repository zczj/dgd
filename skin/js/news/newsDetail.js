"use strict";var newsModel=new Vue({el:"#model-newsDetail",data:{newsData:"",newsId:"",Pro:"",TopNews:"",Sm:!1,webShare:!1,webShareWx:!1,comment:"",comTxt:"",jbType:""},methods:{getNews:function(){$("#loader").fadeIn(300),this.$http.get(headerModel.api+"/News/GetNews/"+this.newsId+"?token="+headerModel.token).then(function(e){e.data&&(e.data.message?console.log(e.data.message):(this.newsData=e.data,DGDTOOLS.Ev._btnCs())),$("#loader").fadeOut(300)})},collection:function(){var e=this,t=e.newsData.newsinfo.IsCollect?0:1;return headerModel.isLogin?($("#loader").fadeIn(300),void $.ajax({url:headerModel.api+"/MyCenter/AddCollection",data:{token:headerModel.token,Object:1,ObjectID:e.newsData.newsinfo.NewsID,Title:e.newsData.newsinfo.newtitle,Remark:"",Type:t},type:"post",success:function(t){$("#loader").fadeOut(300),200==t.resultid?e.newsData.newsinfo.IsCollect=!e.newsData.newsinfo.IsCollect:t.message&&console.error(t.message)},error:function(){$("#loader").fadeOut(300)}})):void DGDTOOLS.check._isLogin()},formartDate:function(e){return DGDTOOLS.fT._covnerTimeLine(e)},formartKeyWords:function(e){var t=[];return t=e.split("；")},getIntPro:function(){$("#loader").fadeIn(300),this.$http.get(headerModel.api+"/ZhongChou/GetList?pagesize=2&state=0&currentpage=1&token="+headerModel.token).then(function(e){this.Pro=e.data,$("#loader").fadeOut(300)})},getIntNew:function(){this.$http.get(headerModel.api+"/News/GetTopRecommend?count=10&categoryid=0").then(function(e){this.TopNews=e.data})},timeFormart:function(e){var t=new Date(e);return DGDTOOLS.fT._convertTime(t)},wechat:function(){if(DGDTOOLS.check._isWeixin())this.webShareWx=!0;else{this.webShare=!0;var e=new DGDTOOLS.Ev._loadJS("/skin/js/project/qrcode.min.js");if(null==e)return void setTimeout(function(){DGDTOOLS.Ev._createQrcode(document.querySelector("#canvas"))},40);e.onload=function(){DGDTOOLS.Ev._createQrcode(document.querySelector("#canvas"))}}},getComment:function(){this.$http.get(headerModel.api+"/News/GetComment?ObjectID=news_"+this.newsId).then(function(e){e.data&&(this.comment=e.data),headerModel.loading=!1})},checkComment:function(e){return headerModel.isLogin?""!=e.val()||(DGDTOOLS.tip._tip("请说两句。。。",function(){e.focus()}),!1):(DGDTOOLS.check._isLogin(),!1)},toggleRepay:function(e,t){var o=this,n=$(t.target).parents(".com-cont"),a='<div class="com-form"><div class="com-inner"><textarea placeholder="来说两句吧……" value="" class="com-box"></textarea></div> <div class="com-ft clearfix"><!----> <button data-color="#fff">发表评论</button></div></div>';return n.find(".com-form").length?void n.find(".com-form").toggle():(n.append(a),void n.find("button").click(function(){o.comTxt=n.find("textarea").val(),console.log(o.comTxt),o.postComment(e,n.find("textarea"))}))},postComment:function(e,t){var o=this,n=e?e:0;t=t?t:$(o.$refs.comTxt),o.comTxt=t.val(),o.checkComment(t)&&(headerModel.loading=!0,$.ajax({url:headerModel.api+"/News/AddComm",data:{token:headerModel.token,newsid:o.newsId,Content:o.comTxt,ParentID:n,CommentType:"news_"},type:"post",success:function(e){headerModel.loading=!1,200==e.resultid?(t.val(""),o.getComment()):DGDTOOLS.tip._tip(e.message)},error:function(e){headerModel.loading=!1,DGDTOOLS.tip._tip(e.status+":接口异常"),console.error(e.status+":"+e.responseText)}}))},zanFn:function(e,t){var o=this;headerModel.loading=!0,o.$http.get(headerModel.api+"/News/AddSp?commid="+e).then(function(e){headerModel.loading=!1,200==e.data.resultid?o.comList[t].Sp=e.data.Sp:DGDTOOLS.tip._tip(e.data.message)})},jbFn:function(e){var t=this,o='<div ref="jbPop" class="jbPop" style="min-width:300px;"><label><input type="radio" name="jbType" value="1" v-model="jbType"><i class="icon icon-os"></i>淫秽色情</label><label><input type="radio" name="jbType" value="2" v-model="jbType"><i class="icon icon-os"></i>广告垃圾</label><label><input type="radio" name="jbType" value="3" v-model="jbType"><i class="icon icon-os"></i>违法作息</label><label><input type="radio" name="jbType" value="4" v-model="jbType"><i class="icon icon-os"></i>其他</label></div>',n=$.dialog({type:"jb-head",message:o,buttons:[{text:"取消",type:"red"},{text:"举报",type:"green",callback:function(){var o=$(".jbPop").find("input:checked").val();return o?(t.jbType=o,headerModel.loading=!0,$.ajax({url:headerModel.api+"/News/Repost",data:{CommentID:e,Type:o,token:headerModel.token},type:"post",success:function(e){headerModel.loading=!1,200==e.resultid?DGDTOOLS.tip._tip("提交成功！",function(){n.close()}):DGDTOOLS.tip._tip(e.message)},error:function(e){headerModel.loading=!1,DGDTOOLS.tip._tip(e.status+":接口异常"),console.error(e.status+":"+e.responseText)}})):DGDTOOLS.tip._tip("请选择你的举报内容！"),!1}}],maskOpacity:.4,effect:!0})}},computed:{comList:function(){for(var e=[],t=[],o=this.comment.ComList?this.comment.ComList:[],n=0;n<o.length;n++)0==o[n].ParentID?(o[n].comSon=[],e.push(o[n])):t.push(o[n]);for(var a=0;a<e.length;a++)for(var n=0;n<t.length;n++)t[n].ParentID==e[a].CommentID&&e[a].comSon.push(t[n]);return e}},mounted:function(){this.newsId=window.location.search.split("id=")[1]||0,window.onload=function(){setTimeout(function(){DGDTOOLS.Ev._share(".item-share")},2e3)},this.getNews(),this.getIntPro(),this.getIntNew(),this.getComment()}});