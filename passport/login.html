<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=0,minimum-scale=1.0,maximum-scale=1.0,minimal-ui"/>
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"/>
    <title>Document</title>
    <link rel="stylesheet" href="/skin/plugs/normalize-css/normalize.css"/>
    <link rel="stylesheet" href="/skin/css/base.css"/>
    <link rel="stylesheet" href="/skin/css/dialog.css"/>
    <script src="http://www.zczj.com/skin/js/jquery.min.js"></script>
    <script src="//cdn.bootcss.com/vue/2.0.5/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/vue.resource/1.0.3/vue-resource.min.js"></script>
    <script src="/skin/plugs/dialog/js/dialog.js"></script>
    <script src="/skin/js/util.js"></script>
  </head>
  <body>
    <header id="header">
      <div class="container clearfix">
        <div v-bind:class="{navLogin: !isLogin}" class="nav"><a href="/" class="logo"><img src="/skin/img/logo.png" alt=""/></a>
          <div class="triggers"><a href="#" v-on:click="showMean" class="mean-btn"><i class="icon icon-catgray"></i></a></div>
          <nav v-bind:class="{ navShow: tag }" v-cloak=""><a href="#" v-for="(item, index) in navs" v-bind:class="{ cur : index == 0 }" class="border-1px">{{item}}</a></nav>
          <div class="login-btns">
            <ul class="tool-nav">
              <li class="login-btn">
                <div v-if="isLogin" class="login">
                  <div class="item"><a href="/passport/login.html">登录</a></div><span class="line">|</span>
                  <div class="item"><a href="/passport/register.html">注册</a></div>
                </div>
                <div v-else="" class="login">
                  <div class="item"><a href="/mycenter/index"><img :src="userInfo.Avatar" alt=""/></a></div>
                  <div class="item"><a href="/">退出</a></div>
                </div>
              </li>
              <li class="go-zczj"><a href="http://m.dgd.vc/">前往之家</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div v-bind:class="{'mask-show': tag}" v-on:click="closeMean" class="mask"></div>
      <input id="userId" type="hidden"/>
      <script src="/skin/js/header.js"></script>
    </header>
    <!--==================================================-->
    <link rel="stylesheet" href="/skin/css/passport.css"/>
    <div id="login" v-cloak="v-cloak" class="h-passport-page">
      <div class="container">
        <div class="passport-profile-wrapper">
          <div class="profile"></div>
        </div>
        <div class="passport-content-wrapper">
          <div class="passport-box-wrapper">
            <div class="passport-box">
              <!-- 账号登录-->
              <transition name="fade">
                <div v-show="!formShow" class="passport-item account">
                  <h2 class="passport-header">登录</h2>
                  <ul class="passport-form">
                    <li>
                      <input type="text" placeholder="输入您的帐号" class="passport-input account"/>
                    </li>
                    <li>
                      <input type="password" placeholder="输入您的密码" v-on:keyup.enter="login" class="passport-input password"/>
                    </li>
                    <transition name="fade">
                      <li v-show="error" class="error">{{errorMsg}}</li>
                    </transition>
                    <li>
                      <label class="remember">
                        <input type="checkbox"/>记住密码
                      </label>
                      <div class="forgot"><a href="./fpwd.html">忘记密码</a></div>
                    </li>
                  </ul>
                  <button v-on:click="login" class="passport-button">登录</button><a href="./register.html" class="passport-button">注册</a>
                </div>
              </transition>
              <!-- 手机验证码登录-->
              <transition name="fade">
                <div v-show="formShow" class="passport-item phoneNum">
                  <h2 class="passport-header">登录</h2>
                  <ul class="passport-form">
                    <li>
                      <input type="text" placeholder="输入您的手机号" class="passport-input"/>
                    </li>
                    <li>
                      <input type="text" placeholder="输入图形验证码" class="passport-input"/><img src="../skin/img/passport/verify.png" alt="" class="verify"/><i v-on:click="refreshVerify()" class="icon icon-refresh"></i>
                    </li>
                    <li>
                      <input type="text" placeholder="输入手机验证码" class="passport-input"/><span v-on:click="sendSMS" v-html="sms" v-bind:class="{disabled: sended}" class="sms"></span>
                      <transition name="fade">
                        <li v-show="error" class="error">{{errorMsg}}</li>
                      </transition>
                    </li>
                  </ul>
                  <button v-on:click="login" class="passport-button">登录</button><a href="./register.html" class="passport-button">注册</a>
                </div>
              </transition>
            </div>
            <div class="switch-login-box">
              <button v-show="!formShow" v-on:click="formShow=true" class="passport-button phone-login"><i class="icon icon-phone"></i>手机验证码登录</button>
              <button v-on:click="formShow=false" v-show="formShow" class="passport-button user-login"><i class="icon icon-user"></i>账号密码登录</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="../skin/js/jquery-md5.min.js"></script>
    <script>
      new Vue({
        el: '#login',
        data: {
          formShow: false, // 显示隐藏手机登录还是账号登录
          sms: '发送',
          sended: false,  // 是否已发送短信验证码
          error: false,  // 表单验证错误提示
          errorMsg: '',  // 表单验证错误提示信息
        },
        methods: {
          sendSMS: function () {
            if (this.sended){
              // 已发送短信，倒计时内不可再点击
              return false
            } else {
              // 设置按钮文字状态
              this.countdown()
      
              // 发送短信方法
              console.log(1)
            }
          },
          // 倒计时
          countdown: function () {
            var num = 20, timer = null, _this = this
            this.sms = '重新发送(<em style="color:red;font-style:normal;">'+num+'</em>)s'
            this.sended = true
            timer = setInterval(function () {
              num--
              if( num <=0 ){
                clearInterval(timer)
                _this.sended = false
                _this.sms = '重新发送'
                return
              }
              _this.sms = '重新发送(<em style="color:red;font-style:normal;">'+num+'</em>)s'
            }, 1000)
          },
          // 重新获取验证码
          refreshVerify: function () {
            console.log('重新获取验证码')
          },
          login: function () {
            var _this = this, _delay = 5000,
                account = $('.account input.account').val(),
                // 密码加密
                password =  $.md5($.md5($('.account input.password').val()))
      
            if (account == '' || password == '') {
              _this.errorMsg = '账号或密码不能为空'
              _this.error = true
              setTimeout(function () {
                _this.error = false
              }, _delay)
            } else {
              $("#loader").fadeIn(300)
              $.ajax({
                url: 'http://devapi.zczj.com:80/api/Passport/Login',
                data: {
                  'Account': account,
                  'Password': password
                },
                type: 'post',
                success: function (response) {
                  if(response){
                    $("#loader").fadeOut(300)
      
                    if(response.resultid !== 200){
                      // 请求成功，账号或密码不正确
                      _this.error = true
                      _this.errorMsg = response.message
                      setTimeout(function () {
                        _this.error = false
                      }, _delay)
                    } else if (response.resultid === 200) {
                      // 请求成功，账号密码正确，登录成功
                      $("#loader").fadeOut(300)
                      // 登录成功，跳转
                      // doSomething
                      //用户信息
                      //{"token":"","uid":,"Avatar":"","UserName":"","message":"","resultid":}
                      DGDTOOLS.store.save('userInfo', response);
                      window.location.href = './success.html?login'
                    }
                  }
                }
              })
            }
          }
        }
      
      })
    </script>
    <!--==================================================-->
    <div class="footer">
      <div class="info">
        <div class="container clearfix">
          <dl>
            <dt>关于大股东</dt>
            <dd>关于我们</dd>
            <dd>平台公告</dd>
            <dd>联系我们</dd>
            <dd>招贤纳士</dd>
          </dl>
          <dl>
            <dt>帮助中心</dt>
            <dd>注册登录</dd>
            <dd>转让质押</dd>
            <dd>资费标准</dd>
            <dd>投资</dd>
          </dl>
          <dl>
            <dt>资讯与活动</dt>
            <dd>站内资讯</dd>
            <dd>行业快讯</dd>
            <dd>众筹之家</dd>
            <dd>平台活动</dd>
          </dl>
          <dl>
            <dt>联系我们</dt>
            <dd><img src="http://www.dgd.vc/skin/img/ewm.png" alt="大股东"/>
              <p>联系地址：深圳市南山区科技园中区讯美科技广场3栋14层A03</p>
              <p>联系人：股东妹</p>
              <p>联系电话：0755-82557958</p>
              <p>投资Q群：306742456</p>
            </dd>
          </dl>
        </div>
      </div>
      <div class="bottom">
        <div class="container"><span>深圳市网筹互联网金融服务有限公司</span><span>ICP证：粤ICP备14040204号-2</span></div>
      </div>
    </div>
    <div id="loader" class="loader">
      <loader-inner class="ball-clip-rotate-pulse">
        <div></div>
        <div></div>
      </loader-inner>
    </div>
  </body>
</html>